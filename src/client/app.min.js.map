{"version":3,"file":"app.min.js","sources":["api.js","app.js","controller/cla.js","controller/home.js","controller/my-cla.js","controller/root.js","controller/settings.js","modals/confirm.js","modals/error.js","modals/info.js","modals/link.js","modals/report.js"],"names":["ResultSet","this","loaded","loading","module","angular","filters","element","document","ready","bootstrap","config","$stateProvider","$urlRouterProvider","$locationProvider","state","url","templateUrl","controller","params","user","owner","repo","gist","abstract","template","otherwise","html5Mode","enabled","requireBase","run","$rootScope","$state","$stateParams","prototype","set","error","value","affix","Array","concat","factory","$q","$http","call","m","functn","data","callback","now","Date","post","success","res","JSON","parse","ex","get","user_token","deferred","defer","header","Accept","Authorization","headers","status","resolve","err","reject","promise","d","$RAW","$log","debug","parse_link_header","length","Error","parts","split","links","forEach","p","section","replace","trim","name","exec","type","args","meta","link","hasMore","next","getMore","arg","page","o","obj","fun","direct_call","wrap","$HUB","exec_direct","$RPC","$window","$scope","$RPCService","$HUBService","$modal","$sce","$timeout","getCLA","cla","claText","raw","checkCLA","signed","checkRepo","exists","signedCLA","repoExists","redirect","getUser","admin","scopes","indexOf","agree","acceptUrl","pullRequest","location","href","userPromise","repoPromise","then","trustAsHtml","text","all","$document","$location","$anchorScroll","repos","gists","claRepos","selectedRepo","selectedGist","query","errorMsg","openSettings","users","selectedIndex","nextstep","step1","active","defaultClas","githubGists","githubUserRepos","logAdminIn","isNotClaRepo","match","some","claRepo","login","mixRepoData","fork","updateScopeData","repoSet","push","$broadcast","getRepos","orgRepo","getGists","getDefaultClaFiles","gistFile","Object","keys","files","filename","html_url","showErrorMessage","i","splice","linkSuccess","modal","open","windowClass","scope","result","newLink","confirmAdd","linkStatus","confirmRemove","remove","info","clear","$event","stopPropagation","undefined","isValid","valid","addWebhook","removeWebhook","addRepo","newClaRepo","promise1","promise2","scrollTo","id","scrollTopAnimated","isActive","viewLocation","groupDefaultCla","found","defCla","directive","resize","attrs","el","positionElement","css","innerHeight","innerWidth","bind","$apply","iconSrc","time","children","start","filter","arr","notMatched","item","$filter","signedCLAs","orderBy","getSignedCLA","order","predicate","reverse","getSignatures","gist_url","getGithubUserData","getUsers","signature","gistArgs","history","gist_version","gistIndex","version","gistValid","signatures","contributors","csvHeader","open_error","getContributors","contributor","user_name","repo_owner","repo_name","gist_name","getGistName","signed_at","created_at","getGist","linked","fileName","update","renderHtml","html_code","report","getReport","elem","attr","transclude","$modalInstance","ok","close","cancel","dismiss","origin","console","log"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\n// *****************************************************\r\n// API\r\n// *****************************************************\r\n\r\nfunction ResultSet() {\r\n\r\n    this.loaded = false;\r\n    this.loading = true;\r\n\r\n}\r\n\r\nResultSet.prototype.set = function(error, value) {\r\n\r\n    this.loaded = true;\r\n    this.loading = false;\r\n\r\n    this.error = error;\r\n    this.affix = value;\r\n    this.value = (this.value instanceof Array && value instanceof Array) ? this.value.concat(value) : value;\r\n\r\n};\r\n\r\n\r\nmodule.factory('$RAW', ['$q', '$http',\r\n    function($q, $http) {\r\n        return {\r\n            call: function(m, functn, data, callback) {\r\n                var now = new Date();\r\n                return $http.post('/api/' + m + '/' + functn, data)\r\n                    .success(function(res) {\r\n                        // parse result (again)\r\n                        try {\r\n                            res = JSON.parse(res);\r\n                        } catch (ex) {}\r\n                        // yield result\r\n                        callback(null, res, new Date() - now);\r\n                    })\r\n                    .error(function(res) {\r\n                        callback(res, null, new Date() - now);\r\n                    });\r\n            },\r\n            get: function(url, user_token) {\r\n                var deferred = $q.defer();\r\n                var header = {};\r\n                    header.Accept = 'application/vnd.github.moondragon+json';\r\n                if (user_token) {\r\n                    header.Authorization = 'token ' + user_token;\r\n                }\r\n                $http.get(url, {'headers': header}).\r\n                    success(function(data, status){\r\n                        deferred.resolve(data);\r\n                        // callback(null, data, status);\r\n                    })\r\n                    .error(function(err, status){\r\n                        deferred.reject(err);\r\n                        // callback(err, null, status);\r\n                    });\r\n\r\n                return deferred.promise;\r\n            },\r\n            post: function(url, d, user_token) {\r\n                var deferred = $q.defer();\r\n                $http.post(url, d).\r\n                    success(function(data, status){\r\n                        deferred.resolve(data);\r\n                        // callback(null, data, status);\r\n                    })\r\n                    .error(function(err, status){\r\n                        deferred.reject(err);\r\n                        // callback(err, null, status);\r\n                    });\r\n\r\n                return deferred.promise;\r\n            }\r\n        };\r\n    }\r\n]);\r\n\r\n\r\nmodule.factory('$RPC', ['$RAW', '$log',\r\n    function($RAW, $log) {\r\n\r\n        return {\r\n            call: function(m, functn, data, callback) {\r\n                var res = new ResultSet();\r\n                $RAW.call(m, functn, data, function(error, value) {\r\n                    res.set(error, value);\r\n                    $log.debug('$RPC', m, functn, data, res, res.error);\r\n                    if (typeof callback === 'function') {\r\n                        callback(res.error, res);\r\n                    }\r\n                });\r\n                return res;\r\n            }\r\n        };\r\n    }\r\n]);\r\n\r\n\r\nmodule.factory('$HUB', ['$RAW', '$log',\r\n    function($RAW, $log) {\r\n        function parse_link_header(header) {\r\n            if (header.length === 0) {\r\n                throw new Error('input must not be of zero length');\r\n            }\r\n\r\n            // Split parts by comma\r\n            var parts = header.split(',');\r\n            var links = {};\r\n            // Parse each part into a named link\r\n            parts.forEach( function(p) {\r\n                var section = p.split(';');\r\n                if (section.length !== 2) {\r\n                    throw new Error('section could not be split on \";\"');\r\n                }\r\n                var url = section[0].replace(/<(.*)>/, '$1').trim();\r\n                var name = section[1].replace(/rel=\"(.*)\"/, '$1').trim();\r\n                links[name] = url;\r\n            });\r\n\r\n            return links;\r\n        }\r\n\r\n        var exec = function(type, res, args, call) {\r\n            $RAW.call('github', type, args, function(error, value) {\r\n\r\n                var data = value ? value.data : null;\r\n                var meta = value ? value.meta : null;\r\n\r\n                if (!data && value) {\r\n                    data = value;\r\n                }\r\n\r\n                res.set(error, data);\r\n\r\n                if(meta) {\r\n                    res.meta = meta;\r\n                    var links = meta.link ? parse_link_header(meta.link) : null;\r\n\r\n                    res.hasMore = meta.hasMore || (!!links && !!links.next);\r\n\r\n                    res.getMore = res.hasMore ? function() {\r\n\r\n                        res.loaded = false;\r\n                        res.loading = true;\r\n\r\n                        if (links.next) {\r\n                            args.url = links.next;\r\n                        }\r\n                        else {\r\n                            args.arg.page = args.arg.page + 1 || 2;\r\n                        }\r\n\r\n                        exec(type, res, args, call);\r\n\r\n                    } : null;\r\n                }\r\n\r\n                $log.debug('$HUB', args, res, res.error);\r\n\r\n                if (typeof call === 'function') {\r\n                    call(res.error, res);\r\n                }\r\n            });\r\n            return res;\r\n        };\r\n\r\n        return {\r\n            call: function(o, functn, data, callback) {\r\n                return exec('call', new ResultSet(), { obj: o, fun: functn, arg: data }, callback);\r\n            },\r\n            direct_call: function(url, data, callback) {\r\n                return exec('direct_call', new ResultSet(), { url: url, arg: data }, callback);\r\n            },\r\n            wrap: function(o, functn, data, callback) {\r\n                return exec('wrap', new ResultSet(), { obj: o, fun: functn, arg: data }, callback);\r\n            }\r\n        };\r\n    }\r\n\r\n\r\n]);\r\n\r\n\r\n// *****************************************************\r\n// Angular Route Provider Resolve Promises\r\n// *****************************************************\r\n\r\n\r\nmodule.factory('$HUBService', ['$q', '$HUB',\r\n    function($q, $HUB) {\r\n\r\n        var exec = function(type, o, functn, data, callback) {\r\n            var deferred = $q.defer();\r\n            $HUB[type](o, functn, data, function(err, obj) {\r\n\r\n                if (typeof callback === 'function') {\r\n                    callback(err, obj);\r\n                }\r\n\r\n                if(!err) {\r\n                    deferred.resolve(obj);\r\n                }\r\n                return deferred.reject(err);\r\n            });\r\n            return deferred.promise;\r\n        };\r\n\r\n        var exec_direct = function(type, url, data) {\r\n            var deferred = $q.defer();\r\n            $HUB[type](url, data, function(err, obj) {\r\n                if(!err) {\r\n                    if (obj.hasMore) {\r\n                        obj.getMore();\r\n                    } else {\r\n                        return deferred.resolve(obj);\r\n                    }\r\n                } else {\r\n                    return deferred.reject(err);\r\n                }\r\n            });\r\n            return deferred.promise;\r\n        };\r\n\r\n        return {\r\n            call: function(o, functn, data, callback) {\r\n                return exec('call', o, functn, data, callback);\r\n            },\r\n            direct_call: function(url, data) {\r\n                return exec_direct('direct_call', url, data);\r\n            },\r\n            wrap: function(o, functn, data, callback) {\r\n                return exec('wrap', o, functn, data, callback);\r\n            }\r\n        };\r\n    }\r\n]);\r\n\r\n\r\n// *****************************************************\r\n// Angular Route Provider Resolve Promises\r\n// *****************************************************\r\n\r\n\r\nmodule.factory('$RPCService', ['$q', '$RPC',\r\n    function($q, $RPC) {\r\n        return {\r\n            call: function(o, functn, data, callback) {\r\n                var deferred = $q.defer();\r\n                $RPC.call(o, functn, data, function(err, obj) {\r\n\r\n                    if (typeof callback === 'function') {\r\n                        callback(err, obj);\r\n                    }\r\n\r\n                    if(!err) {\r\n                        deferred.resolve(obj);\r\n                    }\r\n                    return deferred.reject();\r\n                });\r\n                return deferred.promise;\r\n            }\r\n        };\r\n    }\r\n]);\r\n","var module = angular.module('app',\r\n    ['cla.filters',\r\n     'ui.utils',\r\n     'ui.router',\r\n     'ui.bootstrap',\r\n     'ui.select',\r\n     'ngSanitize',\r\n     'ngAnimate',\r\n     'ngCsv']);\r\n\r\nvar filters = angular.module('cla.filters', []);\r\n// *************************************************************\r\n// Delay start\r\n// *************************************************************\r\n\r\nangular.element(document).ready(function() {\r\n    angular.bootstrap(document, ['app']);\r\n});\r\n\r\n// *************************************************************\r\n// States\r\n// *************************************************************\r\n\r\nmodule.config(['$stateProvider', '$urlRouterProvider', '$locationProvider',\r\n    function($stateProvider, $urlRouterProvider, $locationProvider) {\r\n\r\n        $stateProvider\r\n            //\r\n            // Home state\r\n            //\r\n            .state('home', {\r\n                url: '/',\r\n                templateUrl: '/templates/home.html',\r\n                controller: 'HomeCtrl'\r\n            })\r\n\r\n            //\r\n            // Settings view\r\n            //\r\n            .state('home.settings', {\r\n                // url: '/detail/:user/:repo',\r\n                templateUrl: '/templates/settings.html',\r\n                controller: 'SettingsCtrl',\r\n                params: {'user': {}, 'owner': {}, 'repo': {}, 'gist': {}}\r\n                // params: ['user', 'owner', 'repo', 'gist'] <-- was in older angular version\r\n            })\r\n\r\n            //\r\n            // My-CLA state\r\n            //\r\n            .state('cla', {\r\n                abstract: true,\r\n                url: '/my-cla',\r\n                template: '<section ui-view></section>'\r\n            })\r\n\r\n\r\n            .state('cla.myCla', {\r\n                url: '',\r\n                templateUrl: '/templates/my-cla.html',\r\n                controller: 'MyClaCtrl'\r\n            })\r\n\r\n            //\r\n            // Repo state (abstract)\r\n            //\r\n            .state('repo', {\r\n                abstract: true,\r\n                url: '/:user/:repo?pullRequest',\r\n                template: '<section ui-view></section>'\r\n            })\r\n\r\n            //\r\n            // Repo cla\r\n            //\r\n            .state('repo.cla', {\r\n                url: '',\r\n                templateUrl: '/templates/cla.html',\r\n                controller: 'ClaController'\r\n            });\r\n\r\n        $urlRouterProvider.otherwise('/');\r\n\r\n        $locationProvider.html5Mode({\r\n            enabled: true,\r\n            requireBase: false\r\n        });\r\n    }\r\n])\r\n.run(['$rootScope', '$state', '$stateParams',\r\n    function($rootScope, $state, $stateParams) {\r\n        $rootScope.$state = $state;\r\n        $rootScope.$stateParams = $stateParams;\r\n    }\r\n]);\r\n","// *****************************************************\r\n// CLA Controller\r\n//\r\n// tmpl: cla.html\r\n// path: /:repoId/:prId\r\n// *****************************************************\r\n\r\nmodule.controller( 'ClaController', ['$window', '$scope', '$stateParams', '$RAW', '$RPCService', '$HUBService', '$modal', '$sce', '$timeout', '$http', '$q',\r\n    function($window, $scope, $stateParams, $RAW, $RPCService, $HUBService, $modal, $sce, $timeout, $http, $q) {\r\n\r\n        $scope.cla = null;\r\n        $scope.signed = false;\r\n        $scope.signedCLA = null;\r\n        $scope.repoExists = false;\r\n        $scope.params = $stateParams;\r\n        $scope.user = {};\r\n        $scope.redirect = 'https://github.com/' + $stateParams.user + '/' + $stateParams.repo;\r\n\r\n        function getCLA () {\r\n            return $RPCService.call('cla', 'get', {\r\n                repo: $stateParams.repo,\r\n                owner: $stateParams.user\r\n            }, function(err, cla) {\r\n                if(!err) {\r\n                    $scope.claText = cla.value.raw;\r\n                }\r\n            });\r\n        }\r\n\r\n        function checkCLA() {\r\n            return $RPCService.call('cla', 'check', {\r\n                repo: $stateParams.repo,\r\n                owner: $stateParams.user\r\n            }, function(err, signed){\r\n                if (!err && signed.value) {\r\n                    $scope.signed = true;\r\n                }\r\n            });\r\n        }\r\n\r\n        function checkRepo(callback) {\r\n            return $RPCService.call('repo', 'check', {\r\n                repo: $stateParams.repo,\r\n                owner: $stateParams.user\r\n            }, function(err, exists){\r\n                callback(exists.value);\r\n            });\r\n        }\r\n\r\n        var getUser = function(){\r\n            return $HUBService.call('user', 'get', {}, function(err, res){\r\n                if (err) {\r\n                    return;\r\n                }\r\n\r\n                $scope.user = res;\r\n                $scope.user.value.admin = false;\r\n\r\n                if (res.meta && res.meta.scopes && res.meta.scopes.indexOf('write:repo_hook') > -1) {\r\n                    $scope.user.value.admin = true;\r\n                }\r\n            });\r\n        };\r\n\r\n\r\n        // function getDiff(){\r\n        //     return $RPCService.call('cla', 'get', {\r\n        //         repo: $stateParams.repo,\r\n        //         owner: $stateParams.user,\r\n        //         gist: {\r\n        //             gist_url: $scope.signedCLA.gist_url,\r\n        //             gist_version: $scope.signedCLA.gist_version\r\n        //         }\r\n        //     }, function(err, cla) {\r\n        //         if(!err) {\r\n        //             $scope.signedCLA.text = cla.value.raw;\r\n        //         }\r\n        //     });\r\n        // }\r\n\r\n        function getLastSignature(){\r\n            var promise = $RPCService.call('cla', 'getLastSignature', {\r\n                repo: $stateParams.repo,\r\n                owner: $stateParams.user\r\n            });\r\n\r\n            promise.then(function(data){\r\n                $RPCService.call('cla', 'get', {\r\n                    repo: $stateParams.repo,\r\n                    owner: $stateParams.user,\r\n                    gist: {gist_url: data.value.gist_url,\r\n                            gist_version: data.value.gist_version}\r\n                }).then(function(cla_data){\r\n                    $scope.signedCLA.text = cla_data.value.raw;\r\n                });\r\n            });\r\n\r\n            return promise;\r\n        }\r\n\r\n        $scope.agree = function(){\r\n            var acceptUrl = '/accept/' + $stateParams.user + '/' + $stateParams.repo;\r\n            acceptUrl = $stateParams.pullRequest ? acceptUrl + '?pullRequest=' + $stateParams.pullRequest : acceptUrl;\r\n            $window.location.href = acceptUrl;\r\n        };\r\n\r\n        var userPromise = getUser();\r\n\r\n        var repoPromise = checkRepo(function(exists){\r\n            $scope.repoExists = exists;\r\n            if ($scope.repoExists) {\r\n                getCLA().then(function(data){\r\n                    $scope.cla = $sce.trustAsHtml(data.value.raw);\r\n                    $scope.cla.text = data.value.raw;\r\n                });\r\n            }\r\n        });\r\n\r\n        $q.all([userPromise, repoPromise]).then(function(){\r\n          if ($stateParams.pullRequest) {\r\n              $scope.redirect = $scope.redirect + '/pull/' + $stateParams.pullRequest;\r\n          }\r\n          if ($scope.user && $scope.user.value && $scope.repoExists) {\r\n              checkCLA().then(function(signed){\r\n                  if (signed.value) {\r\n                      $http.get('/logout?noredirect=true');\r\n                      $timeout(function(){\r\n                          $window.location.href = $scope.redirect;\r\n                      }, 5000);\r\n                  }\r\n              });\r\n          }\r\n        });\r\n    }\r\n]);\r\n","// *****************************************************\r\n// Home Controller\r\n//\r\n// tmpl: home.html\r\n// path: /\r\n// *****************************************************\r\n\r\nmodule.controller('HomeCtrl', ['$rootScope', '$scope', '$document', '$HUB', '$RPCService', '$RAW', '$HUBService', '$window', '$modal', '$timeout', '$q', '$location', '$anchorScroll',\r\n    function ($rootScope, $scope, $document, $HUB, $RPCService, $RAW, $HUBService, $window, $modal, $timeout, $q, $location, $anchorScroll) {\r\n\r\n        $scope.repos = [];\r\n        $scope.gists = [];\r\n        $scope.claRepos = [];\r\n        $scope.selectedRepo = {};\r\n        $scope.selectedGist = {};\r\n        $scope.query = {};\r\n        $scope.errorMsg = [];\r\n        $scope.openSettings = false;\r\n        $scope.users = [];\r\n        $scope.selectedIndex = -1;\r\n        $scope.user = {};\r\n        $scope.nextstep = {step1: true};\r\n        $scope.active = 0;\r\n        $scope.defaultClas = [];\r\n        var githubGists = 'https://api.github.com/gists?per_page=100';\r\n        var githubUserRepos = 'https://api.github.com/user/repos?per_page=100';\r\n\r\n\r\n        $scope.logAdminIn = function(){\r\n            $window.location.href = '/auth/github?admin=true';\r\n        };\r\n\r\n        $scope.isNotClaRepo = function(repo){\r\n            var match = false;\r\n            $scope.claRepos.some(function(claRepo){\r\n                match = claRepo.repo === repo.name && claRepo.owner === repo.owner.login ? true : false;\r\n                return match;\r\n            });\r\n            return !match;\r\n        };\r\n\r\n        var mixRepoData = function(claRepo){\r\n            $scope.repos.some(function(repo){\r\n                if (claRepo.repo === repo.name && claRepo.owner === repo.owner.login) {\r\n                    claRepo.fork = repo.fork;\r\n                    return true;\r\n                }\r\n            });\r\n            return claRepo;\r\n        };\r\n\r\n        var updateScopeData = function(){\r\n            var repoSet = [];\r\n            $scope.repos.forEach(function(repo){\r\n                repoSet.push({owner: repo.owner.login, repo: repo.name});\r\n            });\r\n            $RPCService.call('repo', 'getAll', {set: repoSet}, function(err, data){\r\n            // $RPCService.call('repo', 'getAll', {owner: $rootScope.user.value.login}, function(err, data){\r\n                $scope.claRepos = data.value;\r\n                $scope.claRepos.forEach(function(claRepo){\r\n                    claRepo.active = claRepo.gist ? true : false;\r\n                    claRepo = mixRepoData(claRepo);\r\n                });\r\n            });\r\n        };\r\n\r\n        var getUser = function(){\r\n            $rootScope.user = {value: {admin: false}};\r\n\r\n            return $HUBService.call('user', 'get', {}, function(err, res){\r\n                if (err) {\r\n                    return;\r\n                }\r\n\r\n                $scope.user = res;\r\n                $scope.user.value.admin = false;\r\n\r\n                if (res.meta.scopes.indexOf('write:repo_hook') > -1) {\r\n                    $scope.user.value.admin = true;\r\n                }\r\n                $rootScope.user = $scope.user;\r\n                $rootScope.$broadcast('user');\r\n            });\r\n        };\r\n\r\n        var getRepos = function() {\r\n            // var callBack = function(data){\r\n            //     data.value.forEach(function(orgRepo){\r\n            //             $scope.repos.push(orgRepo);\r\n            //         });\r\n            //     if (data.hasMore) {\r\n            //         data.getMore();\r\n            //     } else {\r\n            //         updateScopeData();\r\n            //     }\r\n            // };\r\n\r\n            if ($scope.user && $scope.user.value && $scope.user.value.admin) {\r\n                $HUBService.direct_call(githubUserRepos).then(function(data){\r\n                    data.value.forEach(function(orgRepo){\r\n                            $scope.repos.push(orgRepo);\r\n                        });\r\n                    updateScopeData();\r\n                });\r\n            }\r\n        };\r\n\r\n        var getGists = function(){\r\n            $scope.gists = [];\r\n            if (!$scope.defaultClas.length) {\r\n              $scope.getDefaultClaFiles().then(function(data){\r\n                $scope.gists = $scope.gists.concat($scope.defaultClas);\r\n              });\r\n            }\r\n            $scope.gists = $scope.defaultClas.concat([]);\r\n\r\n            $HUBService.direct_call(githubGists).then(function(data){\r\n                if (data && data.value) {\r\n                    data.value.forEach(function(gist){\r\n                        var gistFile = {};\r\n                        gistFile.name = Object.keys(gist.files)[0];\r\n                        gistFile.name = gist.files[gistFile.name].filename ? gist.files[gistFile.name].filename : gistFile.name;\r\n                        gistFile.url = gist.html_url;\r\n                        $scope.gists.push(gistFile);\r\n                    });\r\n                }\r\n            });\r\n        };\r\n\r\n        // var validateLinkedRepos = function(){\r\n\r\n        // };\r\n\r\n        var showErrorMessage = function(text) {\r\n            var error = text;\r\n            $timeout(function(){\r\n                var i = $scope.errorMsg.indexOf(error);\r\n                if (i > -1) {\r\n                    $scope.errorMsg.splice(i, 1);\r\n                }\r\n            }, 3000);\r\n\r\n            $scope.errorMsg.push(error);\r\n        };\r\n\r\n        var linkSuccess = function(){\r\n            var modal = $modal.open({\r\n                templateUrl: '/modals/templates/linkSuccess.html',\r\n                controller: 'LinkCtrl',\r\n                windowClass: 'link-success',\r\n                scope: $scope,\r\n                resolve: {\r\n                    selectedGist: function(){ return $scope.selectedGist; },\r\n                    selectedRepo: function(){ return $scope.selectedRepo; }\r\n                }\r\n            });\r\n\r\n            modal.result.then(function(){\r\n                $scope.selectedRepo = {};\r\n                $scope.selectedGist = {};\r\n                $scope.newLink = false;\r\n            }, function(){\r\n                $scope.selectedRepo = {};\r\n                $scope.selectedGist = {};\r\n                $scope.newLink = false;\r\n            });\r\n        };\r\n\r\n        var confirmAdd = function() {\r\n            var modal = $modal.open({\r\n                templateUrl: '/modals/templates/confirmLink.html',\r\n                controller: 'ConfirmCtrl',\r\n                windowClass: 'confirm-add',\r\n                resolve: {\r\n                    selectedGist: function(){ return $scope.selectedGist; },\r\n                    selectedRepo: function(){ return $scope.selectedRepo; }\r\n                }\r\n            });\r\n            modal.result.then(function(){\r\n                $scope.linkStatus = null;\r\n                linkSuccess();\r\n                $scope.link().then(function(){\r\n                    $scope.linkStatus = 'linked';\r\n                }, function(){\r\n                    $scope.linkStatus = 'failed';\r\n                });\r\n            });\r\n        };\r\n\r\n        $scope.confirmRemove = function(claRepo){\r\n            var modal = $modal.open({\r\n                templateUrl: '/modals/templates/confirmRemove.html',\r\n                controller: 'ConfirmCtrl',\r\n                windowClass: 'confirm-add',\r\n                resolve: {\r\n                    selectedGist: function(){ return {}; },\r\n                    selectedRepo: function(){ return claRepo; }\r\n                }\r\n            });\r\n            modal.result.then(function(repo){\r\n                $scope.remove(repo);\r\n            });\r\n        };\r\n\r\n        $scope.info = function() {\r\n            $modal.open({\r\n                templateUrl: '/modals/templates/info_gist.html',\r\n                controller: 'InfoCtrl',\r\n                windowClass: 'howto'\r\n            });\r\n        };\r\n\r\n        $scope.getDefaultClaFiles = function(){\r\n            return $RAW.get('/static/cla-assistant.json').then(function(data){\r\n              $scope.defaultClas = data['default-cla'];\r\n            });\r\n        };\r\n\r\n        getUser().then(function(){\r\n            getRepos();\r\n            getGists();\r\n        });\r\n\r\n        $scope.clear = function($event, obj) {\r\n           $event.stopPropagation();\r\n           if (obj === 'repo') {\r\n              $scope.selectedRepo.repo = undefined;\r\n           } else if (obj === 'gist') {\r\n              $scope.selectedGist.gist = undefined;\r\n           }\r\n        };\r\n\r\n        $scope.isValid = function(gist){\r\n            var valid = false;\r\n             // valid = value ? !!value.match(/https:\\/\\/gist\\.github\\.com\\/([a-zA-Z0-9_-]*)\\/[a-zA-Z0-9]*$/) : false;\r\n            valid = gist ? !!gist.match(/https:\\/\\/gist\\.github\\.com\\/([a-zA-Z0-9_-]*)/) : false;\r\n            return valid;\r\n        };\r\n\r\n        $scope.addWebhook = function(claRepo){\r\n            // $scope.gistValid = $scope.isValid($scope.repo.gist);\r\n            // if ($scope.repo.gist && !$scope.gistValid) {\r\n            //     return;\r\n            // }\r\n            if (claRepo.gist) {\r\n                $RPCService.call('webhook', 'create', {repo: claRepo.repo, owner: claRepo.owner}, function(err, data){\r\n                    if (!err && data && data.value) {\r\n                        claRepo.active = data.value.active;\r\n                    }\r\n                });\r\n            }\r\n        };\r\n\r\n        $scope.removeWebhook = function(claRepo){\r\n            $RPCService.call('webhook', 'remove', {repo: claRepo.repo, user: claRepo.owner}, function(err, data){\r\n                if (!err) {\r\n                    claRepo.active = false;\r\n                }\r\n            });\r\n        };\r\n\r\n\r\n        $scope.addRepo = function(){\r\n            confirmAdd();\r\n            // return;\r\n        };\r\n\r\n        $scope.link = function(){\r\n            var newClaRepo = {repo: $scope.selectedRepo.repo.name, owner: $scope.selectedRepo.repo.owner.login, gist: $scope.selectedGist.gist.url, active: false};\r\n            newClaRepo = mixRepoData(newClaRepo);\r\n            var promise1 = $RPCService.call('repo', 'create', {repo: newClaRepo.repo, owner: newClaRepo.owner, gist: newClaRepo.gist}, function(err, data){\r\n                if (err && err.err.match(/.*duplicate key error.*/)) {\r\n                    showErrorMessage('This repository is already set up.');\r\n                }\r\n                if (err || !data.value) {\r\n                    $scope.removeWebhook(newClaRepo);\r\n                    var i = $scope.claRepos.indexOf(newClaRepo);\r\n                    if (i > -1) {\r\n                        $scope.claRepos.splice(i, 1);\r\n                    }\r\n                } else {\r\n                    $scope.claRepos.push(newClaRepo);\r\n                    $scope.query.text = '';\r\n                }\r\n            });\r\n\r\n            var promise2 = $scope.addWebhook(newClaRepo);\r\n            return $q.all([promise1, promise2]);\r\n        };\r\n\r\n        $scope.remove = function(claRepo){\r\n            $RPCService.call('repo', 'remove', {repo: claRepo.repo, owner: claRepo.owner, gist: claRepo.gist}, function(err, data){\r\n                if (!err) {\r\n                    var i = $scope.claRepos.indexOf(claRepo);\r\n                    if (i > -1) {\r\n                        $scope.claRepos.splice(i, 1);\r\n                    }\r\n                }\r\n            });\r\n\r\n            $RPCService.call('webhook', 'remove', {repo: claRepo.repo, user: claRepo.owner}, function(err, data){\r\n                if (!err) {\r\n                    claRepo.active = false;\r\n                }\r\n            });\r\n        };\r\n\r\n        // $scope.getSignatures = function(claRepo){\r\n        //     return $RPCService.call('cla', 'getAll', {repo: claRepo.repo, owner: claRepo.owner, gist: {gist_url: claRepo.gist}});\r\n        // };\r\n        //\r\n        // var getGithubUserData = function(login){\r\n        //     return $HUBService.call('user', 'getFrom', {user: login});\r\n        // };\r\n        //\r\n        // $scope.getUsers = function(claRepo){\r\n        //     return $scope.getSignatures(claRepo).then(function(data){\r\n        //         $scope.users = [];\r\n        //         if (data && data.value) {\r\n        //             data.value.forEach(function(signature){\r\n        //                 getGithubUserData(signature.user).then(function(user){\r\n        //                     user.value.cla = signature;\r\n        //                     $scope.users.push(user.value);\r\n        //\r\n        //                 });\r\n        //             });\r\n        //         }\r\n        //     });\r\n        // };\r\n\r\n        $scope.scrollTo = function(id) {\r\n            $document.scrollTopAnimated(0, 800);\r\n        };\r\n\r\n        $scope.isActive = function (viewLocation) {\r\n            return viewLocation === $location.url();\r\n        };\r\n\r\n        $scope.groupDefaultCla = function(gist){\r\n            var found = false;\r\n\r\n            $scope.defaultClas.some(function(defCla){\r\n              if (gist.url === defCla.url) {\r\n                found = true;\r\n                return found;\r\n              }\r\n            });\r\n\r\n            return found ? 'Default CLAs' : 'My Gist Files';\r\n        };\r\n    }\r\n])\r\n.directive('resize', ['$window', function($window){\r\n    return {\r\n        scope: {\r\n            resize: '@'\r\n        },\r\n        link: function(scope, element, attrs){\r\n            var el = element;\r\n            var inititalElOffset;\r\n\r\n            var positionElement = function(){\r\n                if (scope.resize === 'height') {\r\n                    el.css('height', $window.innerHeight + 'px');\r\n                } else if (scope.resize === 'max-width'){\r\n                    el.css('max-width', this.innerWidth - 100);\r\n                }\r\n            };\r\n\r\n            angular.element($window).bind('resize', function(){\r\n                positionElement();\r\n                scope.$apply();\r\n            });\r\n\r\n            angular.element($window).bind('load', function(){\r\n                positionElement();\r\n                scope.$apply();\r\n            });\r\n        }\r\n    };\r\n}])\r\n.directive('feature', ['$window', function($window){\r\n    return {\r\n        templateUrl: '/templates/feature.html',\r\n        scope: {\r\n            id: '@',\r\n            iconSrc: '@',\r\n            header: '@',\r\n            text: '@'\r\n        },\r\n        link: function(scope, element, attrs){\r\n\r\n        }\r\n    };\r\n}])\r\n.directive('textSlider', ['$window', '$timeout', function($window, $timeout){\r\n    return {\r\n        scope: {\r\n            time: '@',\r\n            active: '='\r\n        },\r\n        link: function(scope, element, attrs){\r\n            var children = element.children();\r\n            var start = function(){\r\n                $timeout(function(){\r\n                    scope.active = scope.active + 1 === children.length ? 0 : scope.active + 1;\r\n                    start();\r\n                }, scope.time);\r\n            };\r\n\r\n            start();\r\n        }\r\n    };\r\n}]);\r\n\r\nfilters.filter('notIn', function() {\r\n    return function(repos, arr) {\r\n\r\n        if(arr.length === 0) {\r\n            return repos;\r\n        }\r\n\r\n        var notMatched = [];\r\n\r\n        repos.forEach(function(item){\r\n            var found = false;\r\n            arr.some(function(claRepo){\r\n                found = claRepo.repo === item.name && claRepo.owner === item.owner.login ? true : false;\r\n                return found;\r\n            });\r\n            if (!found) {\r\n                notMatched.push(item);\r\n            }\r\n        });\r\n\r\n        return notMatched;\r\n    };\r\n});\r\n","// *****************************************************\r\n// My-CLA Controller\r\n//\r\n// tmpl: my-cla.html.html\r\n// path: /\r\n// *****************************************************\r\n\r\nmodule.controller('MyClaCtrl', ['$rootScope', '$scope', '$filter', '$document', '$HUB', '$RPCService', '$RAW', '$HUBService', '$window', '$modal', '$timeout', '$q', '$location', '$anchorScroll',\r\n    function ($rootScope, $scope, $filter, $document, $HUB, $RPCService, $RAW, $HUBService, $window, $modal, $timeout, $q, $location, $anchorScroll) {\r\n\r\n\r\n      $scope.repos = [];\r\n      $scope.claRepos = [];\r\n      $scope.signedCLAs= [];\r\n      $scope.users = [];\r\n      $scope.user = {};\r\n      $scope.defaultClas = [];\r\n\r\n      var orderBy = $filter('orderBy');\r\n\r\n      var githubUserRepos = 'https://api.github.com/user/repos?per_page=100';\r\n\r\n      $scope.logAdminIn = function(){\r\n          $window.location.href = '/auth/github?admin=true';\r\n      };\r\n\r\n      var getUser = function(){\r\n          $scope.user = {value: {admin: false}};\r\n\r\n          return $HUBService.call('user', 'get', {}, function(err, res){\r\n              if (err) {\r\n                  return;\r\n              }\r\n\r\n              $scope.user = res;\r\n              $scope.user.value.admin = false;\r\n\r\n              if (res.meta.scopes.indexOf('write:repo_hook') > -1) {\r\n                  $scope.user.value.admin = true;\r\n              }\r\n              //$rootScope.user = $scope.user;\r\n              //$rootScope.$broadcast('user');\r\n          });\r\n      };\r\n\r\n      var getRepos = function() {\r\n          // var callBack = function(data){\r\n          //     data.value.forEach(function(orgRepo){\r\n          //             $scope.repos.push(orgRepo);\r\n          //         });\r\n          //     if (data.hasMore) {\r\n          //         data.getMore();\r\n          //     } else {\r\n          //         updateScopeData();\r\n          //     }\r\n          // };\r\n\r\n          if ($scope.user && $scope.user.value && $scope.user.value.admin) {\r\n              $HUBService.direct_call(githubUserRepos).then(function(data){\r\n                  data.value.forEach(function(orgRepo){\r\n                          $scope.repos.push(orgRepo);\r\n                      });\r\n                  updateScopeData();\r\n              });\r\n          }\r\n      };\r\n\r\n      var getSignedCLA = function(){\r\n        return $RPCService.call('cla', 'getSignedCLA', {user: $scope.user.value.login}, function(err, data){\r\n          $scope.claRepos = data.value;\r\n        });\r\n      };\r\n\r\n      getUser().then(function(){\r\n          getRepos();\r\n          getSignedCLA();\r\n      });\r\n\r\n      $scope.order = function(predicate, reverse){\r\n        $scope.claRepos = orderBy($scope.claRepos, predicate, reverse);\r\n      };\r\n\r\n      $scope.getSignatures = function(claRepo){\r\n          return $RPCService.call('cla', 'getAll', {repo: claRepo.repo, owner: claRepo.owner, gist: {gist_url: claRepo.gist}});\r\n      };\r\n\r\n      var updateScopeData = function(){\r\n          var repoSet = [];\r\n          $scope.repos.forEach(function(repo){\r\n              repoSet.push({owner: repo.owner.login, repo: repo.name});\r\n          });\r\n          $RPCService.call('repo', 'getAll', {set: repoSet}, function(err, data){\r\n          // $RPCService.call('repo', 'getAll', {owner: $rootScope.user.value.login}, function(err, data){\r\n          //    $scope.claRepos = data.value;\r\n          //    $scope.claRepos.forEach(function(claRepo){\r\n          //        claRepo = mixRepoData(claRepo);\r\n          //    });\r\n          });\r\n      };\r\n\r\n      var mixRepoData = function(claRepo){\r\n          $scope.repos.some(function(repo){\r\n              if (claRepo.repo === repo.name && claRepo.owner === repo.owner.login) {\r\n                  claRepo.fork = repo.fork;\r\n                  return true;\r\n              }\r\n          });\r\n          return claRepo;\r\n      };\r\n\r\n      $scope.isNotClaRepo = function(repo){\r\n          var match = false;\r\n          $scope.claRepos.some(function(claRepo){\r\n              match = claRepo.repo === repo.name && claRepo.owner === repo.owner.login ? true : false;\r\n              return match;\r\n          });\r\n          return !match;\r\n      };\r\n\r\n      $scope.getDefaultClaFiles = function(){\r\n          return $RAW.get('/static/cla-assistant.json').then(function(data){\r\n            $scope.defaultClas = data['default-cla'];\r\n          });\r\n      };\r\n\r\n      var getGithubUserData = function(login){\r\n          return $HUBService.call('user', 'getFrom', {user: login});\r\n      };\r\n\r\n      $scope.getUsers = function(claRepo){\r\n          return $scope.getSignatures(claRepo).then(function(data){\r\n              $scope.users = [];\r\n              if (data && data.value) {\r\n                  data.value.forEach(function(signature){\r\n                      getGithubUserData(signature.user).then(function(user){\r\n                          user.value.cla = signature;\r\n                          $scope.users.push(user.value);\r\n\r\n                      });\r\n                  });\r\n              }\r\n          });\r\n      };\r\n    }\r\n  ]);\r\n","// *****************************************************\r\n// Root Controller\r\n// *****************************************************\r\n\r\nmodule.controller('RootCtrl', ['$rootScope', '$scope', '$stateParams', '$HUB', '$RPC', '$RAW', '$timeout',\r\n    function($rootScope, $scope, $stateParams, $HUB, $RPC, $RAW, $timeout) {\r\n\r\n        // $rootScope.user = {value: {admin: false}};\r\n        // $rootScope.loading = true;\r\n\r\n        // $HUB.call('user', 'get', {}, function(err, res){\r\n        //     $rootScope.loading = false;\r\n        //     if (err) {\r\n        //         return;\r\n        //     }\r\n\r\n        //     $timeout(function() {\r\n        //         $rootScope.user = res;\r\n        //         $rootScope.user.value.admin = false;\r\n\r\n        //         if (res.meta.scopes.indexOf('write:repo_hook') > -1) {\r\n        //             $rootScope.user.value.admin = true;\r\n        //         }\r\n\r\n        //         $rootScope.$broadcast('user');\r\n        //     }, 0);\r\n        // });\r\n    }\r\n]);\r\n","// *****************************************************\r\n// Detail Controller\r\n//\r\n// tmpl: detail.html\r\n// path: /detail/:ruser/:repo\r\n// *****************************************************\r\n\r\nmodule.controller('SettingsCtrl', ['$rootScope', '$scope', '$stateParams', '$HUB', '$RPCService', '$HUBService', '$window', '$sce', '$modal',\r\n    function ($rootScope, $scope, $stateParams, $HUB, $RPCService, $HUBService, $window, $sce, $modal) {\r\n\r\n        $scope.gist = {};\r\n        $scope.gistIndex = 0;\r\n        $scope.admin = false;\r\n        $scope.errorMsg = [];\r\n        $scope.loading = false;\r\n        $scope.gistValid = true;\r\n        $scope.signatures = [];\r\n        $scope.contributors = [];\r\n\r\n        $scope.csvHeader = ['User Name', 'Repository Owner', 'Repository Name', 'CLA Title', 'Gist URL', 'Gist Version', 'Signed At'];\r\n\r\n        function gistArgs () {\r\n            var args = {gist_url: $scope.repo.gist};\r\n            if ($scope.gist.history && $scope.gist.history.length > 0) {\r\n                args.gist_version = $scope.gist.history[$scope.gistIndex].version;\r\n            }\r\n            return args;\r\n        }\r\n\r\n        $scope.isValid = function(gist){\r\n            var valid = false;\r\n             // valid = value ? !!value.match(/https:\\/\\/gist\\.github\\.com\\/([a-zA-Z0-9_-]*)\\/[a-zA-Z0-9]*$/) : false;\r\n            valid = gist ? !!gist.match(/https:\\/\\/gist\\.github\\.com\\/([a-zA-Z0-9_-]*)/) : false;\r\n            return valid ? gist : undefined;\r\n        };\r\n\r\n        $scope.open_error = function(){\r\n            var modal = $modal.open({\r\n                templateUrl: '/modals/templates/error_modal.html',\r\n                controller: 'ErrorCtrl'\r\n            });\r\n        };\r\n\r\n        $scope.getSignatures = function(claRepo){\r\n            return $RPCService.call('cla', 'getAll', {repo: claRepo.repo, owner: claRepo.owner, gist: {gist_url: claRepo.gist}});\r\n        };\r\n\r\n        var getGithubUserData = function(login){\r\n            return $HUBService.call('user', 'getFrom', {user: login});\r\n        };\r\n\r\n        $scope.getContributors = function(){\r\n            return $scope.getSignatures($scope.repo).then(function(data){\r\n                $scope.contributors = [];\r\n                if (data && data.value && data.value.length > 0) {\r\n                    data.value.forEach(function(signature){\r\n                        var contributor = {};\r\n                        contributor.user_name = signature.user;\r\n                        contributor.repo_owner = $scope.repo.owner;\r\n                        contributor.repo_name = $scope.repo.repo;\r\n                        contributor.gist_name = $scope.getGistName();\r\n                        contributor.gist_url = $scope.gist.url;\r\n                        contributor.gist_version = signature.gist_version;\r\n                        contributor.signed_at = signature.created_at;\r\n\r\n                            $scope.contributors.push(contributor);\r\n                        getGithubUserData(signature.user).then(function(user){\r\n                            contributor.html_url = user.html_url;\r\n                            // $scope.contributors.push(user.value);\r\n\r\n                        });\r\n                    });\r\n                }\r\n            });\r\n        };\r\n\r\n        $scope.getGist = function(){\r\n            $scope.loading = true;\r\n            $RPCService.call('cla', 'getGist', {repo: $scope.repo.repo, owner: $scope.repo.owner, gist: gistArgs()}, function(err, data){\r\n                if (!err && data.value) {\r\n                    $scope.gist = data.value;\r\n                }\r\n                $scope.loading = false;\r\n                $scope.gist.linked = true;\r\n            });\r\n        };\r\n\r\n        $scope.getGistName = function(){\r\n            var fileName = '';\r\n            if ($scope.gist && $scope.gist.files) {\r\n                fileName = Object.keys($scope.gist.files)[0];\r\n                fileName = $scope.gist.files[fileName].filename ? $scope.gist.files[fileName].filename : fileName;\r\n            }\r\n            return fileName;\r\n        };\r\n\r\n        $scope.logAdminIn = function(){\r\n            $window.location.href = '/auth/github?admin=true';\r\n        };\r\n\r\n        // var showErrorMessage = function(text) {\r\n        //     var error = text;\r\n        //     $timeout(function(){\r\n        //         var i = $scope.errorMsg.indexOf(error);\r\n        //         if (i > -1) {\r\n        //             $scope.errorMsg.splice(i, 1);\r\n        //         }\r\n        //     }, 3000);\r\n\r\n        //     $scope.errorMsg.push(error);\r\n        // };\r\n\r\n        $scope.update = function(){\r\n            $scope.gistValid = $scope.isValid($scope.repo.gist);\r\n            if ($scope.repo.gist && !$scope.gistValid) {\r\n                return;\r\n            }\r\n            if ($scope.repo.gist) {\r\n                $RPCService.call('webhook', 'create', {repo: $scope.repo.repo, owner: $scope.repo.owner}, function(err, data){\r\n                    if (!err) {\r\n                        $scope.repo.active = true;\r\n                    }\r\n                });\r\n            } else {\r\n                $RPCService.call('webhook', 'remove', {repo: $scope.repo.repo, user: $scope.repo.owner}, function(err, data){\r\n                    if (!err) {\r\n                        $scope.repo.active = false;\r\n                    }\r\n                });\r\n            }\r\n            $RPCService.call('repo', 'update', {repo: $scope.repo.repo, owner: $scope.repo.owner, gist: $scope.repo.gist}, function(err, data){\r\n                if ($scope.repo.gist) {\r\n                    // $scope.getUsers();\r\n                    $scope.getGist();\r\n                    $scope.getSignatures($scope.repo).then(function(signatures){\r\n                        if (signatures && signatures.value) {\r\n                            $scope.signatures = signatures.value;\r\n                            $scope.contributors = signatures.value;\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        };\r\n\r\n        $scope.renderHtml = function(html_code)\r\n        {\r\n            return $sce.trustAsHtml(html_code);\r\n        };\r\n\r\n        var report = function(claRepo) {\r\n            var modal = $modal.open({\r\n                templateUrl: '/modals/templates/report.html',\r\n                controller: 'ReportCtrl',\r\n                windowClass: 'report',\r\n                scope: $scope,\r\n                resolve: {\r\n                    repo: function(){ return claRepo; }\r\n                }\r\n            });\r\n            // modal.result.then(function(args){});\r\n        };\r\n\r\n        $scope.getReport = function(){\r\n            if ($scope.signatures.length > 0) {\r\n                $scope.getContributors($scope.repo);\r\n                report($scope.repo);\r\n            }\r\n        };\r\n\r\n        if ($scope.repo.gist) {\r\n            $scope.getGist();\r\n            $scope.getSignatures($scope.repo).then(function(signatures){\r\n                if (signatures && signatures.value) {\r\n                    $scope.signatures = signatures.value;\r\n                    $scope.contributors = signatures.value;\r\n                }\r\n            });\r\n        }\r\n    }\r\n]);\r\n\r\nmodule.directive('settings', [function(elem, attr){\r\n    return {\r\n        templateUrl: '/templates/settings.html',\r\n        controller: 'SettingsCtrl',\r\n        transclude: true,\r\n        scope: {\r\n            repo: '=',\r\n            user: '='\r\n        }\r\n    };\r\n}]);\r\n","module.controller('ConfirmCtrl',\r\n\tfunction($scope, $modalInstance, $window, $timeout, selectedGist, selectedRepo, $state, $RPCService) {\r\n\t\t$scope.gist = selectedGist && selectedGist.gist ? selectedGist.gist : null;\r\n\t\t$scope.repo = selectedRepo && selectedRepo.repo ? selectedRepo.repo : null;\r\n\r\n\t\t$scope.ok = function () {\r\n\t\t\t$modalInstance.close(selectedRepo);\r\n\t\t};\r\n\r\n\t\t$scope.cancel = function () {\r\n\t\t\t$modalInstance.dismiss('cancel');\r\n\t\t};\r\n    }\r\n);\r\n","module.controller('ErrorCtrl',\r\n\tfunction($scope, $modalInstance, $window, $timeout, $state, $RPCService) {\r\n\r\n\t\t$scope.ok = function () {\r\n\t\t\t$modalInstance.close();\r\n\t\t};\r\n\r\n\t\t$scope.cancel = function () {\r\n\t\t\t$modalInstance.dismiss('cancel');\r\n\t\t};\r\n    }\r\n);","module.controller('InfoCtrl',\r\n    function($scope, $modalInstance, $window) {\r\n\r\n        $scope.origin = $window.location.origin;\r\n\r\n\t\t$scope.cancel = function () {\r\n\t\t\t$modalInstance.dismiss('cancel');\r\n\t\t};\r\n    }\r\n);\r\n","module.controller('LinkCtrl',\r\n    function($scope, $modalInstance, $window, selectedGist, selectedRepo, $state, $RPCService) {\r\n\t\t// $scope.gist = selectedGist.gist;\r\n\t\t// $scope.repo = selectedRepo.repo;\r\n\r\n        console.log('modal status', $scope.linkStatus);\r\n\r\n\r\n\t\t$scope.ok = function () {\r\n\t\t\t$modalInstance.close();\r\n\t\t};\r\n\r\n\t\t$scope.cancel = function () { \r\n\t\t\t$modalInstance.dismiss('cancel');\r\n\t\t};\r\n    }\r\n);\r\n","module.controller('ReportCtrl', function($scope, $modalInstance, $window, repo, $state, $RPCService) {\r\n\t\t$scope.claRepo = repo;\r\n\t\t$scope.gist = null;\r\n\r\n\t\t//TODO: Code duplication!!! To be improved!\r\n\t\t// $scope.getGistName = function(){\r\n    //     return $scope.gist && $scope.gist.files ? $scope.gist.files[Object.keys($scope.gist.files)[0]].filename : '';\r\n    // };\r\n    //\r\n\t\t// var getGist = function(){\r\n    //     $RPCService.call('cla', 'getGist', {repo: $scope.claRepo.repo, owner: $scope.claRepo.owner, gist: $scope.claRepo.gist}, function(err, data){\r\n    //         if (!err && data.value) {\r\n    //             $scope.gist = data.value;\r\n    //         }\r\n    //     });\r\n    // };\r\n\r\n    $scope.cancel = function () {\r\n        $modalInstance.dismiss('cancel');\r\n    };\r\n\r\n    // getGist();\r\n});\r\n"]}