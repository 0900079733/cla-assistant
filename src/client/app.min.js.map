{"version":3,"file":"app.min.js","sources":["api.js","app.js","controller/cla.js","controller/home.js","controller/my-cla.js","controller/root.js","controller/settings.js","modals/confirm.js","modals/error.js","modals/info.js","modals/link.js","modals/report.js"],"names":["ResultSet","this","loaded","loading","module","angular","filters","element","document","ready","bootstrap","config","$stateProvider","$urlRouterProvider","$locationProvider","state","url","templateUrl","controller","params","user","owner","repo","gist","abstract","template","otherwise","html5Mode","enabled","requireBase","run","$rootScope","$state","$stateParams","prototype","set","error","value","affix","Array","concat","factory","$q","$http","call","m","functn","data","callback","now","Date","post","success","res","JSON","parse","ex","get","user_token","deferred","defer","header","Accept","Authorization","headers","status","resolve","err","reject","promise","d","$RAW","$log","debug","parse_link_header","length","Error","parts","split","links","forEach","p","section","replace","trim","name","exec","type","args","meta","link","hasMore","next","getMore","arg","page","o","obj","fun","direct_call","wrap","$HUB","exec_direct","$RPC","$window","$scope","$RPCService","$HUBService","$modal","$sce","$timeout","getCLA","cla","claText","raw","checkCLA","signed","checkRepo","exists","signedCLA","repoExists","redirect","getUser","admin","scopes","indexOf","agree","acceptUrl","pullRequest","location","href","userPromise","repoPromise","then","trustAsHtml","text","all","$document","$location","$anchorScroll","repos","gists","claRepos","selectedRepo","selectedGist","query","errorMsg","openSettings","users","selectedIndex","nextstep","step1","active","defaultClas","githubGists","githubUserRepos","logAdminIn","isNotClaRepo","match","some","claRepo","login","mixRepoData","fork","updateScopeData","repoSet","push","$broadcast","getRepos","orgRepo","getGists","getDefaultClaFiles","gistFile","Object","keys","files","filename","html_url","showErrorMessage","i","splice","linkSuccess","modal","open","windowClass","scope","result","newLink","confirmAdd","linkStatus","confirmRemove","remove","info","clear","$event","stopPropagation","undefined","isValid","valid","addWebhook","removeWebhook","addRepo","newClaRepo","promise1","promise2","scrollTo","id","scrollTopAnimated","isActive","viewLocation","groupDefaultCla","found","defCla","directive","resize","attrs","el","positionElement","css","innerHeight","innerWidth","bind","$apply","iconSrc","time","children","start","filter","arr","notMatched","item","signedCLAs","getSignedCLA","getSignatures","gist_url","getGithubUserData","getUsers","signature","gistArgs","history","gist_version","gistIndex","version","gistValid","signatures","contributors","csvHeader","open_error","getContributors","contributor","user_name","repo_owner","repo_name","gist_name","getGistName","signed_at","created_at","getGist","linked","fileName","update","renderHtml","html_code","report","getReport","elem","attr","transclude","$modalInstance","ok","close","cancel","dismiss","origin","console","log"],"mappings":"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","sourcesContent":["'use strict';\n\n// *****************************************************\n// API\n// *****************************************************\n\nfunction ResultSet() {\n\n    this.loaded = false;\n    this.loading = true;\n\n}\n\nResultSet.prototype.set = function(error, value) {\n\n    this.loaded = true;\n    this.loading = false;\n\n    this.error = error;\n    this.affix = value;\n    this.value = (this.value instanceof Array && value instanceof Array) ? this.value.concat(value) : value;\n\n};\n\n\nmodule.factory('$RAW', ['$q', '$http',\n    function($q, $http) {\n        return {\n            call: function(m, functn, data, callback) {\n                var now = new Date();\n                return $http.post('/api/' + m + '/' + functn, data)\n                    .success(function(res) {\n                        // parse result (again)\n                        try {\n                            res = JSON.parse(res);\n                        } catch (ex) {}\n                        // yield result\n                        callback(null, res, new Date() - now);\n                    })\n                    .error(function(res) {\n                        callback(res, null, new Date() - now);\n                    });\n            },\n            get: function(url, user_token) {\n                var deferred = $q.defer();\n                var header = {};\n                    header.Accept = 'application/vnd.github.moondragon+json';\n                if (user_token) {\n                    header.Authorization = 'token ' + user_token;\n                }\n                $http.get(url, {'headers': header}).\n                    success(function(data, status){\n                        deferred.resolve(data);\n                        // callback(null, data, status);\n                    })\n                    .error(function(err, status){\n                        deferred.reject(err);\n                        // callback(err, null, status);\n                    });\n\n                return deferred.promise;\n            },\n            post: function(url, d, user_token) {\n                var deferred = $q.defer();\n                $http.post(url, d).\n                    success(function(data, status){\n                        deferred.resolve(data);\n                        // callback(null, data, status);\n                    })\n                    .error(function(err, status){\n                        deferred.reject(err);\n                        // callback(err, null, status);\n                    });\n\n                return deferred.promise;\n            }\n        };\n    }\n]);\n\n\nmodule.factory('$RPC', ['$RAW', '$log',\n    function($RAW, $log) {\n\n        return {\n            call: function(m, functn, data, callback) {\n                var res = new ResultSet();\n                $RAW.call(m, functn, data, function(error, value) {\n                    res.set(error, value);\n                    $log.debug('$RPC', m, functn, data, res, res.error);\n                    if (typeof callback === 'function') {\n                        callback(res.error, res);\n                    }\n                });\n                return res;\n            }\n        };\n    }\n]);\n\n\nmodule.factory('$HUB', ['$RAW', '$log',\n    function($RAW, $log) {\n        function parse_link_header(header) {\n            if (header.length === 0) {\n                throw new Error('input must not be of zero length');\n            }\n\n            // Split parts by comma\n            var parts = header.split(',');\n            var links = {};\n            // Parse each part into a named link\n            parts.forEach( function(p) {\n                var section = p.split(';');\n                if (section.length !== 2) {\n                    throw new Error('section could not be split on \";\"');\n                }\n                var url = section[0].replace(/<(.*)>/, '$1').trim();\n                var name = section[1].replace(/rel=\"(.*)\"/, '$1').trim();\n                links[name] = url;\n            });\n\n            return links;\n        }\n\n        var exec = function(type, res, args, call) {\n            $RAW.call('github', type, args, function(error, value) {\n\n                var data = value ? value.data : null;\n                var meta = value ? value.meta : null;\n\n                if (!data && value) {\n                    data = value;\n                }\n\n                res.set(error, data);\n\n                if(meta) {\n                    res.meta = meta;\n                    var links = meta.link ? parse_link_header(meta.link) : null;\n\n                    res.hasMore = meta.hasMore || (!!links && !!links.next);\n\n                    res.getMore = res.hasMore ? function() {\n\n                        res.loaded = false;\n                        res.loading = true;\n\n                        if (links.next) {\n                            args.url = links.next;\n                        }\n                        else {\n                            args.arg.page = args.arg.page + 1 || 2;\n                        }\n\n                        exec(type, res, args, call);\n\n                    } : null;\n                }\n\n                $log.debug('$HUB', args, res, res.error);\n\n                if (typeof call === 'function') {\n                    call(res.error, res);\n                }\n            });\n            return res;\n        };\n\n        return {\n            call: function(o, functn, data, callback) {\n                return exec('call', new ResultSet(), { obj: o, fun: functn, arg: data }, callback);\n            },\n            direct_call: function(url, data, callback) {\n                return exec('direct_call', new ResultSet(), { url: url, arg: data }, callback);\n            },\n            wrap: function(o, functn, data, callback) {\n                return exec('wrap', new ResultSet(), { obj: o, fun: functn, arg: data }, callback);\n            }\n        };\n    }\n\n\n]);\n\n\n// *****************************************************\n// Angular Route Provider Resolve Promises\n// *****************************************************\n\n\nmodule.factory('$HUBService', ['$q', '$HUB',\n    function($q, $HUB) {\n\n        var exec = function(type, o, functn, data, callback) {\n            var deferred = $q.defer();\n            $HUB[type](o, functn, data, function(err, obj) {\n\n                if (typeof callback === 'function') {\n                    callback(err, obj);\n                }\n\n                if(!err) {\n                    deferred.resolve(obj);\n                }\n                return deferred.reject(err);\n            });\n            return deferred.promise;\n        };\n\n        var exec_direct = function(type, url, data) {\n            var deferred = $q.defer();\n            $HUB[type](url, data, function(err, obj) {\n                if(!err) {\n                    if (obj.hasMore) {\n                        obj.getMore();\n                    } else {\n                        return deferred.resolve(obj);\n                    }\n                } else {\n                    return deferred.reject(err);\n                }\n            });\n            return deferred.promise;\n        };\n\n        return {\n            call: function(o, functn, data, callback) {\n                return exec('call', o, functn, data, callback);\n            },\n            direct_call: function(url, data) {\n                return exec_direct('direct_call', url, data);\n            },\n            wrap: function(o, functn, data, callback) {\n                return exec('wrap', o, functn, data, callback);\n            }\n        };\n    }\n]);\n\n\n// *****************************************************\n// Angular Route Provider Resolve Promises\n// *****************************************************\n\n\nmodule.factory('$RPCService', ['$q', '$RPC',\n    function($q, $RPC) {\n        return {\n            call: function(o, functn, data, callback) {\n                var deferred = $q.defer();\n                $RPC.call(o, functn, data, function(err, obj) {\n\n                    if (typeof callback === 'function') {\n                        callback(err, obj);\n                    }\n\n                    if(!err) {\n                        deferred.resolve(obj);\n                    }\n                    return deferred.reject();\n                });\n                return deferred.promise;\n            }\n        };\n    }\n]);\n","var module = angular.module('app',\n    ['cla.filters',\n     'ui.utils',\n     'ui.router',\n     'ui.bootstrap',\n     'ui.select',\n     'ngSanitize',\n     'ngAnimate',\n     'ngCsv']);\n\nvar filters = angular.module('cla.filters', []);\n// *************************************************************\n// Delay start\n// *************************************************************\n\nangular.element(document).ready(function() {\n    angular.bootstrap(document, ['app']);\n});\n\n// *************************************************************\n// States\n// *************************************************************\n\nmodule.config(['$stateProvider', '$urlRouterProvider', '$locationProvider',\n    function($stateProvider, $urlRouterProvider, $locationProvider) {\n\n        $stateProvider\n            //\n            // Home state\n            //\n            .state('home', {\n                url: '/',\n                templateUrl: '/templates/home.html',\n                controller: 'HomeCtrl'\n            })\n\n            //\n            // Settings view\n            //\n            .state('home.settings', {\n                // url: '/detail/:user/:repo',\n                templateUrl: '/templates/settings.html',\n                controller: 'SettingsCtrl',\n                params: {'user': {}, 'owner': {}, 'repo': {}, 'gist': {}}\n                // params: ['user', 'owner', 'repo', 'gist'] <-- was in older angular version\n            })\n\n            //\n            // My-CLA state\n            //\n            .state('cla', {\n                abstract: true,\n                url: '/my-cla',\n                template: '<section ui-view></section>'\n            })\n\n\n            .state('cla.myCla', {\n                url: '',\n                templateUrl: '/templates/my-cla.html',\n                controller: 'MyClaCtrl'\n            })\n\n            //\n            // Repo state (abstract)\n            //\n            .state('repo', {\n                abstract: true,\n                url: '/:user/:repo?pullRequest',\n                template: '<section ui-view></section>'\n            })\n\n            //\n            // Repo cla\n            //\n            .state('repo.cla', {\n                url: '',\n                templateUrl: '/templates/cla.html',\n                controller: 'ClaController'\n            });\n\n        $urlRouterProvider.otherwise('/');\n\n        $locationProvider.html5Mode({\n            enabled: true,\n            requireBase: false\n        });\n    }\n])\n.run(['$rootScope', '$state', '$stateParams',\n    function($rootScope, $state, $stateParams) {\n        $rootScope.$state = $state;\n        $rootScope.$stateParams = $stateParams;\n    }\n]);\n","// *****************************************************\n// CLA Controller\n//\n// tmpl: cla.html\n// path: /:repoId/:prId\n// *****************************************************\n\nmodule.controller( 'ClaController', ['$window', '$scope', '$stateParams', '$RAW', '$RPCService', '$HUBService', '$modal', '$sce', '$timeout', '$http', '$q',\n    function($window, $scope, $stateParams, $RAW, $RPCService, $HUBService, $modal, $sce, $timeout, $http, $q) {\n\n        $scope.cla = null;\n        $scope.signed = false;\n        $scope.signedCLA = null;\n        $scope.repoExists = false;\n        $scope.params = $stateParams;\n        $scope.user = {};\n        $scope.redirect = 'https://github.com/' + $stateParams.user + '/' + $stateParams.repo;\n\n        function getCLA () {\n            return $RPCService.call('cla', 'get', {\n                repo: $stateParams.repo,\n                owner: $stateParams.user\n            }, function(err, cla) {\n                if(!err) {\n                    $scope.claText = cla.value.raw;\n                }\n            });\n        }\n\n        function checkCLA() {\n            return $RPCService.call('cla', 'check', {\n                repo: $stateParams.repo,\n                owner: $stateParams.user\n            }, function(err, signed){\n                if (!err && signed.value) {\n                    $scope.signed = true;\n                }\n            });\n        }\n\n        function checkRepo(callback) {\n            return $RPCService.call('repo', 'check', {\n                repo: $stateParams.repo,\n                owner: $stateParams.user\n            }, function(err, exists){\n                callback(exists.value);\n            });\n        }\n\n        var getUser = function(){\n            return $HUBService.call('user', 'get', {}, function(err, res){\n                if (err) {\n                    return;\n                }\n\n                $scope.user = res;\n                $scope.user.value.admin = false;\n\n                if (res.meta && res.meta.scopes && res.meta.scopes.indexOf('write:repo_hook') > -1) {\n                    $scope.user.value.admin = true;\n                }\n            });\n        };\n\n\n        // function getDiff(){\n        //     return $RPCService.call('cla', 'get', {\n        //         repo: $stateParams.repo,\n        //         owner: $stateParams.user,\n        //         gist: {\n        //             gist_url: $scope.signedCLA.gist_url,\n        //             gist_version: $scope.signedCLA.gist_version\n        //         }\n        //     }, function(err, cla) {\n        //         if(!err) {\n        //             $scope.signedCLA.text = cla.value.raw;\n        //         }\n        //     });\n        // }\n\n        function getLastSignature(){\n            var promise = $RPCService.call('cla', 'getLastSignature', {\n                repo: $stateParams.repo,\n                owner: $stateParams.user\n            });\n\n            promise.then(function(data){\n                $RPCService.call('cla', 'get', {\n                    repo: $stateParams.repo,\n                    owner: $stateParams.user,\n                    gist: {gist_url: data.value.gist_url,\n                            gist_version: data.value.gist_version}\n                }).then(function(cla_data){\n                    $scope.signedCLA.text = cla_data.value.raw;\n                });\n            });\n\n            return promise;\n        }\n\n        $scope.agree = function(){\n            var acceptUrl = '/accept/' + $stateParams.user + '/' + $stateParams.repo;\n            acceptUrl = $stateParams.pullRequest ? acceptUrl + '?pullRequest=' + $stateParams.pullRequest : acceptUrl;\n            $window.location.href = acceptUrl;\n        };\n\n        var userPromise = getUser();\n\n        var repoPromise = checkRepo(function(exists){\n            $scope.repoExists = exists;\n            if ($scope.repoExists) {\n                getCLA().then(function(data){\n                    $scope.cla = $sce.trustAsHtml(data.value.raw);\n                    $scope.cla.text = data.value.raw;\n                });\n            }\n        });\n\n        $q.all([userPromise, repoPromise]).then(function(){\n          if ($stateParams.pullRequest) {\n              $scope.redirect = $scope.redirect + '/pull/' + $stateParams.pullRequest;\n          }\n          if ($scope.user && $scope.user.value && $scope.repoExists) {\n              checkCLA().then(function(signed){\n                  if (signed.value) {\n                      $http.get('/logout?noredirect=true');\n                      $timeout(function(){\n                          $window.location.href = $scope.redirect;\n                      }, 5000);\n                  }\n              });\n          }\n        });\n    }\n]);\n","// *****************************************************\n// Home Controller\n//\n// tmpl: home.html\n// path: /\n// *****************************************************\n\nmodule.controller('HomeCtrl', ['$rootScope', '$scope', '$document', '$HUB', '$RPCService', '$RAW', '$HUBService', '$window', '$modal', '$timeout', '$q', '$location', '$anchorScroll',\n    function ($rootScope, $scope, $document, $HUB, $RPCService, $RAW, $HUBService, $window, $modal, $timeout, $q, $location, $anchorScroll) {\n\n        $scope.repos = [];\n        $scope.gists = [];\n        $scope.claRepos = [];\n        $scope.selectedRepo = {};\n        $scope.selectedGist = {};\n        $scope.query = {};\n        $scope.errorMsg = [];\n        $scope.openSettings = false;\n        $scope.users = [];\n        $scope.selectedIndex = -1;\n        $scope.user = {};\n        $scope.nextstep = {step1: true};\n        $scope.active = 0;\n        $scope.defaultClas = [];\n        var githubGists = 'https://api.github.com/gists?per_page=100';\n        var githubUserRepos = 'https://api.github.com/user/repos?per_page=100';\n\n\n        $scope.logAdminIn = function(){\n            $window.location.href = '/auth/github?admin=true';\n        };\n\n        $scope.isNotClaRepo = function(repo){\n            var match = false;\n            $scope.claRepos.some(function(claRepo){\n                match = claRepo.repo === repo.name && claRepo.owner === repo.owner.login ? true : false;\n                return match;\n            });\n            return !match;\n        };\n\n        var mixRepoData = function(claRepo){\n            $scope.repos.some(function(repo){\n                if (claRepo.repo === repo.name && claRepo.owner === repo.owner.login) {\n                    claRepo.fork = repo.fork;\n                    return true;\n                }\n            });\n            return claRepo;\n        };\n\n        var updateScopeData = function(){\n            var repoSet = [];\n            $scope.repos.forEach(function(repo){\n                repoSet.push({owner: repo.owner.login, repo: repo.name});\n            });\n            $RPCService.call('repo', 'getAll', {set: repoSet}, function(err, data){\n            // $RPCService.call('repo', 'getAll', {owner: $rootScope.user.value.login}, function(err, data){\n                $scope.claRepos = data.value;\n                $scope.claRepos.forEach(function(claRepo){\n                    claRepo.active = claRepo.gist ? true : false;\n                    claRepo = mixRepoData(claRepo);\n                });\n            });\n        };\n\n        var getUser = function(){\n            $rootScope.user = {value: {admin: false}};\n\n            return $HUBService.call('user', 'get', {}, function(err, res){\n                if (err) {\n                    return;\n                }\n\n                $scope.user = res;\n                $scope.user.value.admin = false;\n\n                if (res.meta.scopes.indexOf('write:repo_hook') > -1) {\n                    $scope.user.value.admin = true;\n                }\n                $rootScope.user = $scope.user;\n                $rootScope.$broadcast('user');\n            });\n        };\n\n        var getRepos = function() {\n            // var callBack = function(data){\n            //     data.value.forEach(function(orgRepo){\n            //             $scope.repos.push(orgRepo);\n            //         });\n            //     if (data.hasMore) {\n            //         data.getMore();\n            //     } else {\n            //         updateScopeData();\n            //     }\n            // };\n\n            if ($scope.user && $scope.user.value && $scope.user.value.admin) {\n                $HUBService.direct_call(githubUserRepos).then(function(data){\n                    data.value.forEach(function(orgRepo){\n                            $scope.repos.push(orgRepo);\n                        });\n                    updateScopeData();\n                });\n            }\n        };\n\n        var getGists = function(){\n            $scope.gists = [];\n            if (!$scope.defaultClas.length) {\n              $scope.getDefaultClaFiles().then(function(data){\n                $scope.gists = $scope.gists.concat($scope.defaultClas);\n              });\n            }\n            $scope.gists = $scope.defaultClas.concat([]);\n\n            $HUBService.direct_call(githubGists).then(function(data){\n                if (data && data.value) {\n                    data.value.forEach(function(gist){\n                        var gistFile = {};\n                        gistFile.name = Object.keys(gist.files)[0];\n                        gistFile.name = gist.files[gistFile.name].filename ? gist.files[gistFile.name].filename : gistFile.name;\n                        gistFile.url = gist.html_url;\n                        $scope.gists.push(gistFile);\n                    });\n                }\n            });\n        };\n\n        // var validateLinkedRepos = function(){\n\n        // };\n\n        var showErrorMessage = function(text) {\n            var error = text;\n            $timeout(function(){\n                var i = $scope.errorMsg.indexOf(error);\n                if (i > -1) {\n                    $scope.errorMsg.splice(i, 1);\n                }\n            }, 3000);\n\n            $scope.errorMsg.push(error);\n        };\n\n        var linkSuccess = function(){\n            var modal = $modal.open({\n                templateUrl: '/modals/templates/linkSuccess.html',\n                controller: 'LinkCtrl',\n                windowClass: 'link-success',\n                scope: $scope,\n                resolve: {\n                    selectedGist: function(){ return $scope.selectedGist; },\n                    selectedRepo: function(){ return $scope.selectedRepo; }\n                }\n            });\n\n            modal.result.then(function(){\n                $scope.selectedRepo = {};\n                $scope.selectedGist = {};\n                $scope.newLink = false;\n            }, function(){\n                $scope.selectedRepo = {};\n                $scope.selectedGist = {};\n                $scope.newLink = false;\n            });\n        };\n\n        var confirmAdd = function() {\n            var modal = $modal.open({\n                templateUrl: '/modals/templates/confirmLink.html',\n                controller: 'ConfirmCtrl',\n                windowClass: 'confirm-add',\n                resolve: {\n                    selectedGist: function(){ return $scope.selectedGist; },\n                    selectedRepo: function(){ return $scope.selectedRepo; }\n                }\n            });\n            modal.result.then(function(){\n                $scope.linkStatus = null;\n                linkSuccess();\n                $scope.link().then(function(){\n                    $scope.linkStatus = 'linked';\n                }, function(){\n                    $scope.linkStatus = 'failed';\n                });\n            });\n        };\n\n        $scope.confirmRemove = function(claRepo){\n            var modal = $modal.open({\n                templateUrl: '/modals/templates/confirmRemove.html',\n                controller: 'ConfirmCtrl',\n                windowClass: 'confirm-add',\n                resolve: {\n                    selectedGist: function(){ return {}; },\n                    selectedRepo: function(){ return claRepo; }\n                }\n            });\n            modal.result.then(function(repo){\n                $scope.remove(repo);\n            });\n        };\n\n        $scope.info = function() {\n            $modal.open({\n                templateUrl: '/modals/templates/info_gist.html',\n                controller: 'InfoCtrl',\n                windowClass: 'howto'\n            });\n        };\n\n        $scope.getDefaultClaFiles = function(){\n            return $RAW.get('/static/cla-assistant.json').then(function(data){\n              $scope.defaultClas = data['default-cla'];\n            });\n        };\n\n        getUser().then(function(){\n            getRepos();\n            getGists();\n        });\n\n        $scope.clear = function($event, obj) {\n           $event.stopPropagation();\n           if (obj === 'repo') {\n              $scope.selectedRepo.repo = undefined;\n           } else if (obj === 'gist') {\n              $scope.selectedGist.gist = undefined;\n           }\n        };\n\n        $scope.isValid = function(gist){\n            var valid = false;\n             // valid = value ? !!value.match(/https:\\/\\/gist\\.github\\.com\\/([a-zA-Z0-9_-]*)\\/[a-zA-Z0-9]*$/) : false;\n            valid = gist ? !!gist.match(/https:\\/\\/gist\\.github\\.com\\/([a-zA-Z0-9_-]*)/) : false;\n            return valid;\n        };\n\n        $scope.addWebhook = function(claRepo){\n            // $scope.gistValid = $scope.isValid($scope.repo.gist);\n            // if ($scope.repo.gist && !$scope.gistValid) {\n            //     return;\n            // }\n            if (claRepo.gist) {\n                $RPCService.call('webhook', 'create', {repo: claRepo.repo, owner: claRepo.owner}, function(err, data){\n                    if (!err && data && data.value) {\n                        claRepo.active = data.value.active;\n                    }\n                });\n            }\n        };\n\n        $scope.removeWebhook = function(claRepo){\n            $RPCService.call('webhook', 'remove', {repo: claRepo.repo, user: claRepo.owner}, function(err, data){\n                if (!err) {\n                    claRepo.active = false;\n                }\n            });\n        };\n\n\n        $scope.addRepo = function(){\n            confirmAdd();\n            // return;\n        };\n\n        $scope.link = function(){\n            var newClaRepo = {repo: $scope.selectedRepo.repo.name, owner: $scope.selectedRepo.repo.owner.login, gist: $scope.selectedGist.gist.url, active: false};\n            newClaRepo = mixRepoData(newClaRepo);\n            var promise1 = $RPCService.call('repo', 'create', {repo: newClaRepo.repo, owner: newClaRepo.owner, gist: newClaRepo.gist}, function(err, data){\n                if (err && err.err.match(/.*duplicate key error.*/)) {\n                    showErrorMessage('This repository is already set up.');\n                }\n                if (err || !data.value) {\n                    $scope.removeWebhook(newClaRepo);\n                    var i = $scope.claRepos.indexOf(newClaRepo);\n                    if (i > -1) {\n                        $scope.claRepos.splice(i, 1);\n                    }\n                } else {\n                    $scope.claRepos.push(newClaRepo);\n                    $scope.query.text = '';\n                }\n            });\n\n            var promise2 = $scope.addWebhook(newClaRepo);\n            return $q.all([promise1, promise2]);\n        };\n\n        $scope.remove = function(claRepo){\n            $RPCService.call('repo', 'remove', {repo: claRepo.repo, owner: claRepo.owner, gist: claRepo.gist}, function(err, data){\n                if (!err) {\n                    var i = $scope.claRepos.indexOf(claRepo);\n                    if (i > -1) {\n                        $scope.claRepos.splice(i, 1);\n                    }\n                }\n            });\n\n            $RPCService.call('webhook', 'remove', {repo: claRepo.repo, user: claRepo.owner}, function(err, data){\n                if (!err) {\n                    claRepo.active = false;\n                }\n            });\n        };\n\n        // $scope.getSignatures = function(claRepo){\n        //     return $RPCService.call('cla', 'getAll', {repo: claRepo.repo, owner: claRepo.owner, gist: {gist_url: claRepo.gist}});\n        // };\n        //\n        // var getGithubUserData = function(login){\n        //     return $HUBService.call('user', 'getFrom', {user: login});\n        // };\n        //\n        // $scope.getUsers = function(claRepo){\n        //     return $scope.getSignatures(claRepo).then(function(data){\n        //         $scope.users = [];\n        //         if (data && data.value) {\n        //             data.value.forEach(function(signature){\n        //                 getGithubUserData(signature.user).then(function(user){\n        //                     user.value.cla = signature;\n        //                     $scope.users.push(user.value);\n        //\n        //                 });\n        //             });\n        //         }\n        //     });\n        // };\n\n        $scope.scrollTo = function(id) {\n            $document.scrollTopAnimated(0, 800);\n        };\n\n        $scope.isActive = function (viewLocation) {\n            return viewLocation === $location.url();\n        };\n\n        $scope.groupDefaultCla = function(gist){\n            var found = false;\n\n            $scope.defaultClas.some(function(defCla){\n              if (gist.url === defCla.url) {\n                found = true;\n                return found;\n              }\n            });\n\n            return found ? 'Default CLAs' : 'My Gist Files';\n        };\n    }\n])\n.directive('resize', ['$window', function($window){\n    return {\n        scope: {\n            resize: '@'\n        },\n        link: function(scope, element, attrs){\n            var el = element;\n            var inititalElOffset;\n\n            var positionElement = function(){\n                if (scope.resize === 'height') {\n                    el.css('height', $window.innerHeight + 'px');\n                } else if (scope.resize === 'max-width'){\n                    el.css('max-width', this.innerWidth - 100);\n                }\n            };\n\n            angular.element($window).bind('resize', function(){\n                positionElement();\n                scope.$apply();\n            });\n\n            angular.element($window).bind('load', function(){\n                positionElement();\n                scope.$apply();\n            });\n        }\n    };\n}])\n.directive('feature', ['$window', function($window){\n    return {\n        templateUrl: '/templates/feature.html',\n        scope: {\n            id: '@',\n            iconSrc: '@',\n            header: '@',\n            text: '@'\n        },\n        link: function(scope, element, attrs){\n\n        }\n    };\n}])\n.directive('textSlider', ['$window', '$timeout', function($window, $timeout){\n    return {\n        scope: {\n            time: '@',\n            active: '='\n        },\n        link: function(scope, element, attrs){\n            var children = element.children();\n            var start = function(){\n                $timeout(function(){\n                    scope.active = scope.active + 1 === children.length ? 0 : scope.active + 1;\n                    start();\n                }, scope.time);\n            };\n\n            start();\n        }\n    };\n}]);\n\nfilters.filter('notIn', function() {\n    return function(repos, arr) {\n\n        if(arr.length === 0) {\n            return repos;\n        }\n\n        var notMatched = [];\n\n        repos.forEach(function(item){\n            var found = false;\n            arr.some(function(claRepo){\n                found = claRepo.repo === item.name && claRepo.owner === item.owner.login ? true : false;\n                return found;\n            });\n            if (!found) {\n                notMatched.push(item);\n            }\n        });\n\n        return notMatched;\n    };\n});\n","// *****************************************************\n// My-CLA Controller\n//\n// tmpl: my-cla.html.html\n// path: /\n// *****************************************************\n\nmodule.controller('MyClaCtrl', ['$rootScope', '$scope', '$document', '$HUB', '$RPCService', '$RAW', '$HUBService', '$window', '$modal', '$timeout', '$q', '$location', '$anchorScroll',\n    function ($rootScope, $scope, $document, $HUB, $RPCService, $RAW, $HUBService, $window, $modal, $timeout, $q, $location, $anchorScroll) {\n\n\n      $scope.repos = [];\n      $scope.claRepos = [];\n      $scope.signedCLAs= [];\n      $scope.users = [];\n      $scope.user = {};\n      $scope.defaultClas = [];\n\n      var githubUserRepos = 'https://api.github.com/user/repos?per_page=100';\n\n      $scope.logAdminIn = function(){\n          $window.location.href = '/auth/github?admin=true';\n      };\n\n      var getUser = function(){\n          $scope.user = {value: {admin: false}};\n\n          return $HUBService.call('user', 'get', {}, function(err, res){\n              if (err) {\n                  return;\n              }\n\n              $scope.user = res;\n              $scope.user.value.admin = false;\n\n              if (res.meta.scopes.indexOf('write:repo_hook') > -1) {\n                  $scope.user.value.admin = true;\n              }\n              //$rootScope.user = $scope.user;\n              //$rootScope.$broadcast('user');\n          });\n      };\n\n      var getRepos = function() {\n          // var callBack = function(data){\n          //     data.value.forEach(function(orgRepo){\n          //             $scope.repos.push(orgRepo);\n          //         });\n          //     if (data.hasMore) {\n          //         data.getMore();\n          //     } else {\n          //         updateScopeData();\n          //     }\n          // };\n\n          if ($scope.user && $scope.user.value && $scope.user.value.admin) {\n              $HUBService.direct_call(githubUserRepos).then(function(data){\n                  data.value.forEach(function(orgRepo){\n                          $scope.repos.push(orgRepo);\n                      });\n                  updateScopeData();\n              });\n          }\n      };\n\n      var getSignedCLA = function(){\n        return $RPCService.call('cla', 'getSignedCLA', {user: $scope.user.value.login}, function(err, data){\n          $scope.claRepos = data.value;\n        });\n      };\n\n      getUser().then(function(){\n          getRepos();\n          getSignedCLA();\n      });\n\n      $scope.getSignatures = function(claRepo){\n          return $RPCService.call('cla', 'getAll', {repo: claRepo.repo, owner: claRepo.owner, gist: {gist_url: claRepo.gist}});\n      };\n\n      var updateScopeData = function(){\n          var repoSet = [];\n          $scope.repos.forEach(function(repo){\n              repoSet.push({owner: repo.owner.login, repo: repo.name});\n          });\n          $RPCService.call('repo', 'getAll', {set: repoSet}, function(err, data){\n          // $RPCService.call('repo', 'getAll', {owner: $rootScope.user.value.login}, function(err, data){\n          //    $scope.claRepos = data.value;\n          //    $scope.claRepos.forEach(function(claRepo){\n          //        claRepo = mixRepoData(claRepo);\n          //    });\n          });\n      };\n\n      var mixRepoData = function(claRepo){\n          $scope.repos.some(function(repo){\n              if (claRepo.repo === repo.name && claRepo.owner === repo.owner.login) {\n                  claRepo.fork = repo.fork;\n                  return true;\n              }\n          });\n          return claRepo;\n      };\n\n      $scope.isNotClaRepo = function(repo){\n          var match = false;\n          $scope.claRepos.some(function(claRepo){\n              match = claRepo.repo === repo.name && claRepo.owner === repo.owner.login ? true : false;\n              return match;\n          });\n          return !match;\n      };\n\n      $scope.getDefaultClaFiles = function(){\n          return $RAW.get('/static/cla-assistant.json').then(function(data){\n            $scope.defaultClas = data['default-cla'];\n          });\n      };\n\n      var getGithubUserData = function(login){\n          return $HUBService.call('user', 'getFrom', {user: login});\n      };\n\n      $scope.getUsers = function(claRepo){\n          return $scope.getSignatures(claRepo).then(function(data){\n              $scope.users = [];\n              if (data && data.value) {\n                  data.value.forEach(function(signature){\n                      getGithubUserData(signature.user).then(function(user){\n                          user.value.cla = signature;\n                          $scope.users.push(user.value);\n\n                      });\n                  });\n              }\n          });\n      };\n    }\n  ]);\n","// *****************************************************\n// Root Controller\n// *****************************************************\n\nmodule.controller('RootCtrl', ['$rootScope', '$scope', '$stateParams', '$HUB', '$RPC', '$RAW', '$timeout',\n    function($rootScope, $scope, $stateParams, $HUB, $RPC, $RAW, $timeout) {\n\n        // $rootScope.user = {value: {admin: false}};\n        // $rootScope.loading = true;\n\n        // $HUB.call('user', 'get', {}, function(err, res){\n        //     $rootScope.loading = false;\n        //     if (err) {\n        //         return;\n        //     }\n\n        //     $timeout(function() {\n        //         $rootScope.user = res;\n        //         $rootScope.user.value.admin = false;\n\n        //         if (res.meta.scopes.indexOf('write:repo_hook') > -1) {\n        //             $rootScope.user.value.admin = true;\n        //         }\n\n        //         $rootScope.$broadcast('user');\n        //     }, 0);\n        // });\n    }\n]);\n","// *****************************************************\n// Detail Controller\n//\n// tmpl: detail.html\n// path: /detail/:ruser/:repo\n// *****************************************************\n\nmodule.controller('SettingsCtrl', ['$rootScope', '$scope', '$stateParams', '$HUB', '$RPCService', '$HUBService', '$window', '$sce', '$modal',\n    function ($rootScope, $scope, $stateParams, $HUB, $RPCService, $HUBService, $window, $sce, $modal) {\n\n        $scope.gist = {};\n        $scope.gistIndex = 0;\n        $scope.admin = false;\n        $scope.errorMsg = [];\n        $scope.loading = false;\n        $scope.gistValid = true;\n        $scope.signatures = [];\n        $scope.contributors = [];\n\n        $scope.csvHeader = ['User Name', 'Repository Owner', 'Repository Name', 'CLA Title', 'Gist URL', 'Gist Version', 'Signed At'];\n\n        function gistArgs () {\n            var args = {gist_url: $scope.repo.gist};\n            if ($scope.gist.history && $scope.gist.history.length > 0) {\n                args.gist_version = $scope.gist.history[$scope.gistIndex].version;\n            }\n            return args;\n        }\n\n        $scope.isValid = function(gist){\n            var valid = false;\n             // valid = value ? !!value.match(/https:\\/\\/gist\\.github\\.com\\/([a-zA-Z0-9_-]*)\\/[a-zA-Z0-9]*$/) : false;\n            valid = gist ? !!gist.match(/https:\\/\\/gist\\.github\\.com\\/([a-zA-Z0-9_-]*)/) : false;\n            return valid ? gist : undefined;\n        };\n\n        $scope.open_error = function(){\n            var modal = $modal.open({\n                templateUrl: '/modals/templates/error_modal.html',\n                controller: 'ErrorCtrl'\n            });\n        };\n\n        $scope.getSignatures = function(claRepo){\n            return $RPCService.call('cla', 'getAll', {repo: claRepo.repo, owner: claRepo.owner, gist: {gist_url: claRepo.gist}});\n        };\n\n        var getGithubUserData = function(login){\n            return $HUBService.call('user', 'getFrom', {user: login});\n        };\n\n        $scope.getContributors = function(){\n            return $scope.getSignatures($scope.repo).then(function(data){\n                $scope.contributors = [];\n                if (data && data.value && data.value.length > 0) {\n                    data.value.forEach(function(signature){\n                        var contributor = {};\n                        contributor.user_name = signature.user;\n                        contributor.repo_owner = $scope.repo.owner;\n                        contributor.repo_name = $scope.repo.repo;\n                        contributor.gist_name = $scope.getGistName();\n                        contributor.gist_url = $scope.gist.url;\n                        contributor.gist_version = signature.gist_version;\n                        contributor.signed_at = signature.created_at;\n\n                            $scope.contributors.push(contributor);\n                        getGithubUserData(signature.user).then(function(user){\n                            contributor.html_url = user.html_url;\n                            // $scope.contributors.push(user.value);\n\n                        });\n                    });\n                }\n            });\n        };\n\n        $scope.getGist = function(){\n            $scope.loading = true;\n            $RPCService.call('cla', 'getGist', {repo: $scope.repo.repo, owner: $scope.repo.owner, gist: gistArgs()}, function(err, data){\n                if (!err && data.value) {\n                    $scope.gist = data.value;\n                }\n                $scope.loading = false;\n                $scope.gist.linked = true;\n            });\n        };\n\n        $scope.getGistName = function(){\n            var fileName = '';\n            if ($scope.gist && $scope.gist.files) {\n                fileName = Object.keys($scope.gist.files)[0];\n                fileName = $scope.gist.files[fileName].filename ? $scope.gist.files[fileName].filename : fileName;\n            }\n            return fileName;\n        };\n\n        $scope.logAdminIn = function(){\n            $window.location.href = '/auth/github?admin=true';\n        };\n\n        // var showErrorMessage = function(text) {\n        //     var error = text;\n        //     $timeout(function(){\n        //         var i = $scope.errorMsg.indexOf(error);\n        //         if (i > -1) {\n        //             $scope.errorMsg.splice(i, 1);\n        //         }\n        //     }, 3000);\n\n        //     $scope.errorMsg.push(error);\n        // };\n\n        $scope.update = function(){\n            $scope.gistValid = $scope.isValid($scope.repo.gist);\n            if ($scope.repo.gist && !$scope.gistValid) {\n                return;\n            }\n            if ($scope.repo.gist) {\n                $RPCService.call('webhook', 'create', {repo: $scope.repo.repo, owner: $scope.repo.owner}, function(err, data){\n                    if (!err) {\n                        $scope.repo.active = true;\n                    }\n                });\n            } else {\n                $RPCService.call('webhook', 'remove', {repo: $scope.repo.repo, user: $scope.repo.owner}, function(err, data){\n                    if (!err) {\n                        $scope.repo.active = false;\n                    }\n                });\n            }\n            $RPCService.call('repo', 'update', {repo: $scope.repo.repo, owner: $scope.repo.owner, gist: $scope.repo.gist}, function(err, data){\n                if ($scope.repo.gist) {\n                    // $scope.getUsers();\n                    $scope.getGist();\n                    $scope.getSignatures($scope.repo).then(function(signatures){\n                        if (signatures && signatures.value) {\n                            $scope.signatures = signatures.value;\n                            $scope.contributors = signatures.value;\n                        }\n                    });\n                }\n            });\n        };\n\n        $scope.renderHtml = function(html_code)\n        {\n            return $sce.trustAsHtml(html_code);\n        };\n\n        var report = function(claRepo) {\n            var modal = $modal.open({\n                templateUrl: '/modals/templates/report.html',\n                controller: 'ReportCtrl',\n                windowClass: 'report',\n                scope: $scope,\n                resolve: {\n                    repo: function(){ return claRepo; }\n                }\n            });\n            // modal.result.then(function(args){});\n        };\n\n        $scope.getReport = function(){\n            if ($scope.signatures.length > 0) {\n                $scope.getContributors($scope.repo);\n                report($scope.repo);\n            }\n        };\n\n        if ($scope.repo.gist) {\n            $scope.getGist();\n            $scope.getSignatures($scope.repo).then(function(signatures){\n                if (signatures && signatures.value) {\n                    $scope.signatures = signatures.value;\n                    $scope.contributors = signatures.value;\n                }\n            });\n        }\n    }\n]);\n\nmodule.directive('settings', [function(elem, attr){\n    return {\n        templateUrl: '/templates/settings.html',\n        controller: 'SettingsCtrl',\n        transclude: true,\n        scope: {\n            repo: '=',\n            user: '='\n        }\n    };\n}]);\n","module.controller('ConfirmCtrl',\n\tfunction($scope, $modalInstance, $window, $timeout, selectedGist, selectedRepo, $state, $RPCService) {\n\t\t$scope.gist = selectedGist && selectedGist.gist ? selectedGist.gist : null;\n\t\t$scope.repo = selectedRepo && selectedRepo.repo ? selectedRepo.repo : null;\n\n\t\t$scope.ok = function () {\n\t\t\t$modalInstance.close(selectedRepo);\n\t\t};\n\n\t\t$scope.cancel = function () {\n\t\t\t$modalInstance.dismiss('cancel');\n\t\t};\n    }\n);\n","module.controller('ErrorCtrl',\n\tfunction($scope, $modalInstance, $window, $timeout, $state, $RPCService) {\n\n\t\t$scope.ok = function () {\n\t\t\t$modalInstance.close();\n\t\t};\n\n\t\t$scope.cancel = function () {\n\t\t\t$modalInstance.dismiss('cancel');\n\t\t};\n    }\n);","module.controller('InfoCtrl',\n    function($scope, $modalInstance, $window) {\n\n        $scope.origin = $window.location.origin;\n\n\t\t$scope.cancel = function () {\n\t\t\t$modalInstance.dismiss('cancel');\n\t\t};\n    }\n);\n","module.controller('LinkCtrl',\n    function($scope, $modalInstance, $window, selectedGist, selectedRepo, $state, $RPCService) {\n\t\t// $scope.gist = selectedGist.gist;\n\t\t// $scope.repo = selectedRepo.repo;\n\n        console.log('modal status', $scope.linkStatus);\n\n\n\t\t$scope.ok = function () {\n\t\t\t$modalInstance.close();\n\t\t};\n\n\t\t$scope.cancel = function () { \n\t\t\t$modalInstance.dismiss('cancel');\n\t\t};\n    }\n);\n","module.controller('ReportCtrl', function($scope, $modalInstance, $window, repo, $state, $RPCService) {\n\t\t$scope.claRepo = repo;\n\t\t$scope.gist = null;\n\n\t\t//TODO: Code duplication!!! To be improved!\n\t\t// $scope.getGistName = function(){\n    //     return $scope.gist && $scope.gist.files ? $scope.gist.files[Object.keys($scope.gist.files)[0]].filename : '';\n    // };\n    //\n\t\t// var getGist = function(){\n    //     $RPCService.call('cla', 'getGist', {repo: $scope.claRepo.repo, owner: $scope.claRepo.owner, gist: $scope.claRepo.gist}, function(err, data){\n    //         if (!err && data.value) {\n    //             $scope.gist = data.value;\n    //         }\n    //     });\n    // };\n\n    $scope.cancel = function () {\n        $modalInstance.dismiss('cancel');\n    };\n\n    // getGist();\n});\n"]}